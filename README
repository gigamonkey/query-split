Note: this code won the code challenge but it was later pointed out
that it's not strictly correct. I don't remember the exact details.